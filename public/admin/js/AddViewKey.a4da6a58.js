(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["AddViewKey"],{"2ce2":function(e,t,a){},"3aa6":function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var i,r=a("bee2"),s=a("d4ec"),n=a("ade3"),c=(a("a4d3"),a("e01a"),a("b0c0"),a("84f8")),o=Object(r["a"])((function e(){Object(s["a"])(this,e),Object(n["a"])(this,"id",void 0),Object(n["a"])(this,"name",void 0),Object(n["a"])(this,"description",void 0),Object(n["a"])(this,"auditTrail",void 0),Object(n["a"])(this,"genre",void 0),Object(n["a"])(this,"languages",void 0),Object(n["a"])(this,"worksOn",void 0),Object(n["a"])(this,"enabled",void 0),Object(n["a"])(this,"inStock",void 0),Object(n["a"])(this,"videoId",void 0),Object(n["a"])(this,"hsnNumber",void 0),Object(n["a"])(this,"codAmount",void 0),Object(n["a"])(this,"headerImageUrl",void 0),Object(n["a"])(this,"platformDetails",void 0),Object(n["a"])(this,"searchPhrase",void 0),Object(n["a"])(this,"sellerDetails",void 0),Object(n["a"])(this,"images",[]),Object(n["a"])(this,"mainCategory",void 0),Object(n["a"])(this,"subCategory",void 0),Object(n["a"])(this,"preOrder",!1),Object(n["a"])(this,"preOrderDate",void 0),this.id="",this.name="",this.description="",this.genre=[],this.languages=[],this.worksOn=[],this.enabled=!1,this.inStock=!0,this.videoId="",this.headerImageUrl="",this.platformDetails=[],this.sellerDetails=[],this.searchPhrase="",this.hsnNumber="",this.codAmount=0,this.mainCategory="",this.subCategory="",this.preOrderDate=""}));i=o,Object(n["a"])(o,"converter",{toFirestore:function(e){return Object(c["a"])(e)},fromFirestore:function(e,t){var a=e.data(t);return Object(c["b"])(i,a)}})},"3d0a":function(e,t,a){"use strict";a.r(t);var i,r=a("c6a6"),s=a("8336"),n=a("b0af"),c=a("99d9"),o=a("cc20"),d=a("62ad"),l=a("a523"),u=a("8fea"),h=a("169a"),b=a("4bd4"),f=a("132d"),v=a("da13"),m=a("8270"),p=a("5d23"),O=a("0fd9"),y=a("b974"),j=a("2fa4"),I=a("8654"),k=a("71d9"),g=a("2a7f"),x=(a("b0c0"),a("ac1f"),a("841c"),function(){var e=this,t=e._self._c;e._self._setupProxy;return t(n["a"],[t(c["d"],[t("span",{staticClass:"headline"},[e._v(e._s(e.label))])]),t(c["c"],[t(b["a"],{ref:"addSellerForm"},[t(O["a"],{attrs:{justify:"start",align:"center"}},[t(d["a"],{attrs:{cols:"12",md:"6",sm:"6","align-self":"start"}},[t(r["a"],{attrs:{items:e.searchItems,loading:e.isProductLoading,"search-input":e.search,clearable:"",light:"","item-text":"name","item-value":"id",label:"Product Name",placeholder:"Start typing to Search","prepend-icon":"mdi-database-search","no-data-text":"Sorry but we couldn't find any results... :(","return-object":""},on:{"update:searchInput":function(t){e.search=t},"update:search-input":function(t){e.search=t},change:e.onProductChange},scopedSlots:e._u([{key:"no-data",fn:function(){return[t(v["a"],[t(p["c"],[e._v(" Search Products ")])],1)]},proxy:!0},{key:"selection",fn:function(a){var i=a.attr,r=a.on,s=a.item,n=a.selected;return[t(o["a"],e._g(e._b({staticClass:"white--text",attrs:{"input-value":n,color:"blue-grey"}},"v-chip",i,!1),r),[t(f["a"],{attrs:{left:""}},[e._v(" mdi-bitcoin ")]),t("span",{domProps:{textContent:e._s(s.name)}})],1)]}},{key:"item",fn:function(a){var i=a.item;return[t(m["a"],{staticClass:"text-h5 font-weight-light white--text",attrs:{color:"indigo"}},[t("img",{attrs:{src:i.headerImageUrl}})]),t(p["a"],[t(p["c"],{domProps:{textContent:e._s(i.name)}})],1)]}}]),model:{value:e.selectedProductId,callback:function(t){e.selectedProductId=t},expression:"selectedProductId"}})],1),e.isProductAvailable?t(d["a"],{attrs:{cols:"12",md:"6",sm:"6","align-self":"center"}},[t(y["a"],{attrs:{"prepend-icon":"mdi-store",label:"Sellers",outlined:"",items:e.sellerList,"item-text":"sellerInfo.name","item-value":"id","loader-height":"4","return-object":"","single-line":"",required:"",rules:[function(e){return!!e||"Seller is required"}]},on:{change:e.fetchKeys},scopedSlots:e._u([{key:"item",fn:function(a){var i=a.item;return[t(m["a"],{staticClass:"text-h5 font-weight-light white--text",attrs:{color:"indigo"}},[t("img",{attrs:{src:i.sellerInfo.logoUrl}})]),t(p["a"],[t(p["c"],{domProps:{textContent:e._s(i.sellerInfo.name)}})],1)]}}],null,!1,1567772100),model:{value:e.selectedSeller,callback:function(t){e.selectedSeller=t},expression:"selectedSeller"}})],1):e._e()],1)],1),t(O["a"],{attrs:{justify:"start",align:"center"}},[t(d["a"],{attrs:{cols:"12","align-self":"start"}},[t(u["a"],{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.keyList,loading:e.isKeysLoading},scopedSlots:e._u([{key:"top",fn:function(){return[t(k["a"],{attrs:{flat:""}},[t(g["a"],[e._v("Key Details")]),t(j["a"]),e.isProductAvailable?t(s["a"],{attrs:{color:"primary"},on:{click:e.addKey}},[e._v(" Add Key ")]):e._e()],1)]},proxy:!0},{key:"item.auditTrail.createdOn",fn:function(a){var i=a.item;return[t("span",[e._v(e._s(new Date(i.auditTrail.createdOn).toLocaleString()))])]}},{key:"item.redeemed",fn:function(a){var i=a.item;return[t(o["a"],{attrs:{color:e.getColor(i.redeemed),dark:""}},[e._v(" "+e._s(i.redeemed?"Redeemed":"Not Redeemed")+" ")])]}},{key:"item.actions",fn:function(a){var i=a.item;return[t(f["a"],{staticClass:"mr-2",attrs:{small:""},on:{click:function(t){return e.editItem(i)}}},[e._v(" mdi-pencil ")]),t(f["a"],{attrs:{small:""},on:{click:function(t){return e.deleteItem(i)}}},[e._v(" mdi-delete ")])]}}],null,!0)})],1)],1),t(h["a"],{attrs:{"max-width":"50%"},model:{value:e.keyDialog,callback:function(t){e.keyDialog=t},expression:"keyDialog"}},[t(n["a"],[t(c["d"],[t("span",{staticClass:"headline"},[e._v(e._s(e.formTitle))])]),t(c["c"],[t(l["a"],[t(b["a"],{ref:"form",attrs:{"lazy-validation":""}},[t(O["a"],[t(d["a"],{attrs:{cols:"12",sm:"12",md:"6"}},[t(I["a"],{attrs:{label:"Product ID",outlined:"",readonly:"",dense:""},model:{value:e.editedItem.productId,callback:function(t){e.$set(e.editedItem,"productId",t)},expression:"editedItem.productId"}})],1),t(d["a"],{attrs:{cols:"12",sm:"12",md:"6"}},[t(I["a"],{attrs:{label:"Seller ID",outlined:"",readonly:"",dense:""},model:{value:e.editedItem.sellerInfoId,callback:function(t){e.$set(e.editedItem,"sellerInfoId",t)},expression:"editedItem.sellerInfoId"}})],1),t(d["a"],{attrs:{cols:"12",sm:"12",md:"6"}},[t(I["a"],{attrs:{rules:[function(e){return!!e||"key is required"}],label:"Key",outlined:"",dense:""},model:{value:e.editedItem.key,callback:function(t){e.$set(e.editedItem,"key",t)},expression:"editedItem.key"}})],1)],1)],1)],1)],1),t(c["a"],[t(j["a"]),t(s["a"],{attrs:{color:"blue darken-1",text:""},on:{click:e.close}},[e._v(" Cancel ")]),t(s["a"],{attrs:{color:"blue darken-1",text:""},on:{click:e.save}},[e._v(" Save ")])],1)],1)],1)],1)],1)}),w=[],P=a("c7eb"),D=a("1da1"),_=a("d4ec"),C=a("bee2"),S=a("8f33"),L=a("257e"),K=a("262e"),A=a("ade3"),T=(a("99af"),a("4de4"),a("14d9"),a("a434"),a("d3b7"),a("159b"),a("9ab4")),N=a("60a3"),B=a("7e78"),U=a("174f"),$=a("3d20"),F=a.n($),E=a("3aa6"),q=(a("aaff"),a("98db"),a("ec26")),R=a("84f8"),J=Object(C["a"])((function e(){Object(_["a"])(this,e),Object(A["a"])(this,"id",void 0),Object(A["a"])(this,"sellerInfoId",void 0),Object(A["a"])(this,"sellerId",void 0),Object(A["a"])(this,"productId",void 0),Object(A["a"])(this,"redeemed",!1),Object(A["a"])(this,"redeemedBy",void 0),Object(A["a"])(this,"orderId",void 0),Object(A["a"])(this,"sellerName",void 0),Object(A["a"])(this,"expirable",!1),Object(A["a"])(this,"expiryDate",void 0),Object(A["a"])(this,"key",void 0),Object(A["a"])(this,"redeemedAt",void 0),Object(A["a"])(this,"cartItemId",void 0),Object(A["a"])(this,"auditTrail",void 0),this.id=Object(q["a"])(),this.sellerInfoId="",this.sellerId="",this.productId="",this.redeemedBy="",this.orderId="",this.sellerName="",this.expiryDate=0,this.key="",this.redeemedAt=0,this.cartItemId=""}));i=J,Object(A["a"])(J,"converter",{toFirestore:function(e){return Object(R["a"])(e)},fromFirestore:function(e,t){var a=e.data(t);return Object(R["b"])(i,a)}});var V=function(e){function t(){var e;Object(_["a"])(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return e=Object(S["a"])(this,t,[].concat(i)),Object(A["a"])(Object(L["a"])(e),"isProductAvailable",!1),Object(A["a"])(Object(L["a"])(e),"label","Key Management"),Object(A["a"])(Object(L["a"])(e),"searchItems",[]),Object(A["a"])(Object(L["a"])(e),"isProductLoading",!1),Object(A["a"])(Object(L["a"])(e),"selectedProductId",""),Object(A["a"])(Object(L["a"])(e),"search",""),Object(A["a"])(Object(L["a"])(e),"selectedProduct",void 0),Object(A["a"])(Object(L["a"])(e),"selectedSeller",void 0),Object(A["a"])(Object(L["a"])(e),"sellerList",[]),Object(A["a"])(Object(L["a"])(e),"keyList",[]),Object(A["a"])(Object(L["a"])(e),"isKeysLoading",!1),Object(A["a"])(Object(L["a"])(e),"keyDialog",!1),Object(A["a"])(Object(L["a"])(e),"dialogDelete",!1),Object(A["a"])(Object(L["a"])(e),"editedItem",new J),Object(A["a"])(Object(L["a"])(e),"editIndex",-1),Object(A["a"])(Object(L["a"])(e),"headers",[{text:"Date Added",value:"auditTrail.createdOn"},{text:"Product ID",value:"productId"},{text:"Seller ID",value:"sellerInfoId"},{text:"is redeemed",value:"redeemed"},{text:"Order id",value:"orderId"},{text:"Redeemed By",value:"redeemedBy",sortable:!1},{text:"actions",value:"actions",sortable:!1}]),e}return Object(K["a"])(t,e),Object(C["a"])(t,[{key:"onPropertyChanged",value:function(){var e=Object(D["a"])(Object(P["a"])().mark((function e(t,a){var i,r=this;return Object(P["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,!(t&&""!==t&&t.length>=3)){e.next=7;break}return this.isProductLoading=!0,e.next=5,U["a"].getdocsStartingWithKey("products",t.toLowerCase(),"searchPhrase",E["a"].converter);case 5:i=e.sent,i.empty||i.forEach((function(e){r.searchItems.push(e.data())}));case 7:e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](0),N["c"].toasted.show(e.t0.message,{icon:"face",type:"error"});case 12:return e.prev=12,this.isProductLoading=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,this,[[0,9,12,15]])})));function t(t,a){return e.apply(this,arguments)}return t}()},{key:"mounted",value:function(){var e=Object(D["a"])(Object(P["a"])().mark((function e(){return Object(P["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log("mounted");case 1:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"validateForm",value:function(){var e=Object(D["a"])(Object(P["a"])().mark((function e(){return Object(P["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.$refs.addSellerForm.validate();case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"resetForm",value:function(){this.$refs.addSellerForm.reset()}},{key:"fetchKeys",value:function(){var e=Object(D["a"])(Object(P["a"])().mark((function e(t){return Object(P["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t){e.next=3;break}return e.next=3,this.getKeyDetails();case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getColor",value:function(e){return!0===e?"red":"green"}},{key:"addKey",value:function(){var e=Object(D["a"])(Object(P["a"])().mark((function e(){return Object(P["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.editedItem=new J,this.editedItem.sellerInfoId=this.selectedSeller.sellerInfo.id,this.editedItem.productId=this.selectedProduct.id,this.editedItem.sellerId=this.selectedSeller.id,this.editedItem.sellerName=this.selectedSeller.sellerInfo.name,this.editIndex=-1,this.keyDialog=!0;case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"cancelEdit",value:function(){this.$store.commit("setAddSellerPanel",!1)}},{key:"onProductChange",value:function(e){var t;null!==e?(this.selectedProduct=e,this.sellerList=null===(t=this.selectedProduct)||void 0===t?void 0:t.sellerDetails.filter((function(e){return"DIGITAL"===e.productTypeOffered})),console.log(this.sellerList),this.sellerList.length>0?this.isProductAvailable=!0:this.isProductAvailable=!1):(this.selectedProduct=void 0,this.isProductAvailable=!1,this.keyList=[],this.sellerList=[])}},{key:"getKeyDetails",value:function(){var e=Object(D["a"])(Object(P["a"])().mark((function e(){var t,a=this;return Object(P["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,this.keyList=[],this.isKeysLoading=!0,e.next=5,B["b"].collection("keys").withConverter(J.converter).where("productId","==",this.selectedProduct.id).where("sellerId","==",this.selectedSeller.id).limit(20).get();case 5:t=e.sent,t.empty?N["c"].toasted.show("No results found",{icon:"face",type:"error"}):(t.forEach((function(e){a.keyList.push(e.data())})),N["c"].toasted.show("Search complete",{icon:"face",type:"success"})),e.next=13;break;case 9:e.prev=9,e.t0=e["catch"](0),console.log(e.t0),N["c"].toasted.show(e.t0,{icon:"face",type:"error"});case 13:return e.prev=13,this.isKeysLoading=!1,e.finish(13);case 16:case"end":return e.stop()}}),e,this,[[0,9,13,16]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"closeDelete",value:function(){var e=this;this.dialogDelete=!1,this.$nextTick((function(){e.editedItem=new J,e.editIndex=-1}))}},{key:"close",value:function(){var e=this;this.keyDialog=!1,this.$nextTick((function(){e.editedItem=new J,e.editIndex=-1}))}},{key:"deleteItemConfirm",value:function(){this.keyList.splice(this.editIndex,1),this.closeDelete()}},{key:"formTitle",get:function(){return-1===this.editIndex?"New Key":"Edit Key"}},{key:"save",value:function(){var e=Object(D["a"])(Object(P["a"])().mark((function e(){var t,a,i,r,s,n,c,o,d=this;return Object(P["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.$refs.form.validate()){e.next=22;break}return e.prev=1,t=new Date,-1===this.editIndex?a={createdBy:{uid:null===(i=B["a"].currentUser)||void 0===i?void 0:i.uid,name:null===(r=B["a"].currentUser)||void 0===r?void 0:r.displayName,email:null===(s=B["a"].currentUser)||void 0===s?void 0:s.email},createdOn:t.getTime()}:(a=this.editedItem.auditTrail,a.updatedBy={uid:null===(n=B["a"].currentUser)||void 0===n?void 0:n.uid,name:null===(c=B["a"].currentUser)||void 0===c?void 0:c.displayName,email:null===(o=B["a"].currentUser)||void 0===o?void 0:o.email},a.updatedOn=t.getTime()),this.editedItem.auditTrail=a,e.next=7,B["b"].runTransaction(function(){var e=Object(D["a"])(Object(P["a"])().mark((function e(t){var a;return Object(P["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=B["b"].collection("keys").doc(d.editedItem.id).withConverter(J.converter),t.set(a,d.editedItem,{merge:!0});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 7:return e.sent,N["c"].toasted.show("key added",{icon:"face",type:"success"}),this.$refs.form.resetValidation(),e.next=12,this.getKeyDetails();case 12:this.close(),e.next=19;break;case 15:e.prev=15,e.t0=e["catch"](1),console.log(e.t0),N["c"].toasted.show(e.t0,{icon:"face",type:"error"});case 19:return e.prev=19,this.isKeysLoading=!1,e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[1,15,19,22]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"editItem",value:function(e){this.editIndex=this.keyList.indexOf(e),this.editedItem=Object.assign({},e),this.keyDialog=!0}},{key:"deleteItem",value:function(){var e=Object(D["a"])(Object(P["a"])().mark((function e(t){var a,i;return Object(P["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,F.a.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"});case 3:if(a=e.sent,!a.isConfirmed){e.next=10;break}return e.next=7,U["a"].deleteDocument("keys",t.id);case 7:i=this.keyList.indexOf(t),this.keyList.splice(i,1),F.a.fire("Deleted!","Key has been deleted.","success");case 10:e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](0),N["c"].toasted.show(e.t0.message,{icon:"face",type:"error"});case 15:case"end":return e.stop()}}),e,this,[[0,12]])})));function t(t){return e.apply(this,arguments)}return t}()}]),t}(N["c"]);Object(T["__decorate"])([Object(N["d"])("search")],V.prototype,"onPropertyChanged",null),V=Object(T["__decorate"])([N["a"]],V);var Y=V,z=Y,G=(a("b2a2"),a("2877")),M=Object(G["a"])(z,x,w,!1,null,"c4a9d31e",null);t["default"]=M.exports},b2a2:function(e,t,a){"use strict";a("2ce2")}}]);
//# sourceMappingURL=AddViewKey.a4da6a58.js.map